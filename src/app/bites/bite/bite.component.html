<div
  class="hxl-bite"
  [class.settings-open]="settingsDisplay"
>
  <div class="title">
    <div class="title-content" title="{{biteLogic.title}}">{{biteLogic.title}}</div>
    <div class="title-menu">
      <hxl-simple-dropdown [items]="displayableAvailableBites" (selected)="switchBite($event)"
                           [classDecorator]="selectedBiteClassRenderer"
                           [classDecoratorParam]="bite"
      ></hxl-simple-dropdown>
    </div>
  </div>
  <div *ngIf="!bite.errorMsg; else errorMessage">
    <div class="content" [ngSwitch]="bite.type">
      <hxl-content-topline *ngSwitchCase="classTypes.ToplineBite" [bite]="bite"></hxl-content-topline>
      <hxl-content-chart *ngSwitchCase="classTypes.ChartBite" [bite]="bite"></hxl-content-chart>
      <hxl-content-comparison-chart *ngSwitchCase="classTypes.ComparisonChartBite" [bite]="bite"></hxl-content-comparison-chart>
      <hxl-content-timeseries-chart *ngSwitchCase="classTypes.TimeseriesChartBite" [bite]="bite"></hxl-content-timeseries-chart>
    </div>
  </div>
  <ng-template #errorMessage>
    <div class="content">{{bite.errorMsg}}</div>
  </ng-template>
  <div class="description">
    <div class="description-content">
      {{ biteLogic.description }}
    </div>
  </div>
  <div class="footer">
    <div class="left-section pull-left">
      <a *ngIf="!toolsMode" href="javascript:void(0)" (click)="createEmbedLink()">
        <i class="glyphicon glyphicon-link"></i>
      </a>
      <a href="javascript:void(0)" (click)="saveAsImage()">
        <i class="glyphicon glyphicon-save-file"></i>
      </a>
    </div>
    <form #settingsForm="ngForm" (ngModelChange)="settingsModelChanged($event)">
      <div class="pull-right">
        <span class="powered-by" [class.display]="poweredByDisplay" *ngIf="poweredByDisplay">
          <a href="https://tools.humdata.org/quickcharts/" target="_blank">
            <div *ngIf="poweredBySource != 'undefined' || poweredByUrl != 'undefined' || poweredByDate != 'undefined'" class="settings-menu powered-by-menu dropdown-menu" >
              <div *ngIf="poweredBySource != 'undefined'">
                Source:
                <div class="black-color">{{ poweredBySource }}</div>
              </div>
              <div *ngIf="poweredByUrl != 'undefined' && poweredByDate != 'undefined'">
                <div><a href="{{ poweredByUrl }}" target="_blank">Data</a> - {{ poweredByDate }}</div>
              </div>
            </div>
            Powered by
            <span class="img-span">
              <img class="img-gray" src="./assets/images/hdx-gray.png">
              <img class="img-color" src="./assets/images/hdx-color.png">
            </span>
          </a>
        </span>
        <span>
          <i (click)="toggleSettings(this)" class="glyphicon glyphicon-cog" [class.open]="settingsDisplay"></i>
        </span>
        <div class="settings-menu-shadow" [class.open]="settingsDisplay" (click)="toggleSettings(this);"></div>
        <div class="settings-menu dropdown-menu"
           [class.open]="settingsDisplay"
           [class.arrow-right]="(index % 3 == 0) || (singleBite && poweredByDisplay)"
           [class.arrow-single-embed]="(singleBite && poweredByDisplay)"
           [class.arrow-left]="index % 3 > 0">
          <div class="scrollable-content">
            <div class="section">
              <div class="section-title">
                Chart title
              </div>
              <div class="element-group">
                <input [(ngModel)]="settingsModel.title" type="text" placeholder="Custom chart title" name="title">
              </div>
              <hr/>
            </div>
            <div class="section" *ngIf="(bite.type != classTypes.ToplineBite) && (!asChartBite(bite).pieChart)">
              <div class="section-title">
                Axis & Grid
              </div>
              <div class="element-group" *ngIf="bite.type == classTypes.ChartBite || bite.type == classTypes.ComparisonChartBite">
                <label >
                  Reverse Axis
                </label>
                <div class="checkbox-slider pull-right">
                  <input [checked]="settingsModel.swapAxis"
                         (change)="settingsModel.swapAxis = $event.target.checked; renderContent()"
                         type="checkbox" name="checkbox-slider" class="checkbox-slider-checkbox" id="reverse-axis-{{uuid}}">
                  <label class="checkbox-slider-label" for="reverse-axis-{{uuid}}">
                    <span class="checkbox-slider-inner"></span>
                    <span class="checkbox-slider-switch"></span>
                  </label>
                </div>
              </div>
              <div class="element-group">
                <label >
                  Show Grid
                </label>
                <div class="checkbox-slider pull-right">
                  <input [checked]="settingsModel.showGrid"
                         (change)="settingsModel.showGrid = $event.target.checked; renderContent()"
                         type="checkbox" name="checkbox-slider" class="checkbox-slider-checkbox" id="show-grid-{{uuid}}">
                  <label class="checkbox-slider-label" for="show-grid-{{uuid}}">
                    <span class="checkbox-slider-inner"></span>
                    <span class="checkbox-slider-switch"></span>
                  </label>
                </div>
              </div>
              <div class="element-group">
                <label>
                  Chart values title
                </label>
                <div>
                  <input type="text" placeholder="X Axis Label"
                         [(ngModel)]="settingsModel.xAxisLabel"
                         name="xAxisLabel">
                </div>
              </div>
              <hr/>
            </div>
            <div class="section" *ngIf="bite.type == classTypes.ToplineBite">
              <div class="section-title">
                Number format
              </div>
              <div class="element-group">
                <div class="almost-fifty pull-left">
                  <label>Prefix</label>
                </div>
                <div class="almost-fifty pull-right">
                  <label>Suffix</label>
                </div>
                <div>
                  <input class="almost-fifty" type="text" placeholder="Prefix"
                         [(ngModel)]="settingsModel.prefix" name="prefix">
                  <input class="almost-fifty pull-right" type="text" placeholder="Sufix"
                         [(ngModel)]="settingsModel.suffix" name="suffix">
                </div>
              </div>
              <div class="element-group">
                <label for="decimals-{{uuid}}">
                  Decimals
                </label>
                <!--<input type="number" placeholder="Add custom value" [(ngModel)]="settingsModel.filterCustomValue" name="filterCustomValue">-->
                <select id="decimals-{{uuid}}" [(ngModel)]="settingsModel.numberFormat" name="numberFormat">
                  <option value=""> -- Select -- </option>
                  <option value="de">1.000,00</option>
                  <option value="us">1,000.00</option>
                </select>
              </div>
              <div class="element-group">
                <label >
                  Abbreviate values
                </label>
                <div class="checkbox-slider pull-right">
                  <input type="checkbox" name="checkbox-slider" class="checkbox-slider-checkbox"
                         id="abbreviate-values-{{uuid}}" checked
                         [(ngModel)]="settingsModel.abbreviateValues" name="abbreviateValues">
                  <label class="checkbox-slider-label" for="abbreviate-values-{{uuid}}">
                    <span class="checkbox-slider-inner"></span>
                    <span class="checkbox-slider-switch"></span>
                  </label>
                </div>
              </div>
              <hr/>
            </div>
            <div class="section">
              <div class="section-title">
                Display preference
              </div>
              <div class="element-group" *ngIf="(bite.type == classTypes.ChartBite)">
                <label >
                  Sorting
                </label>
                <div class="pull-right">
                  <div class="checkbox-slider pull-right">
                    <input [checked]="settingsModel.sorting != null"
                           (change)="toggleSorting(); renderContent()"
                           type="checkbox" name="checkbox-slider" class="checkbox-slider-checkbox" id="sorting-{{uuid}}">
                    <label class="checkbox-slider-label" for="sorting-{{uuid}}">
                      <span class="checkbox-slider-inner"></span>
                      <span class="checkbox-slider-switch"></span>
                    </label>
                  </div>
                  <i class="change-sorting glyphicon glyphicon-arrow-up" style="margin-bottom: 3px;"
                    [ngClass]="{'glyphicon-arrow-down': settingsModel.sorting == SORT_DESC}"
                    [style.display]="(settingsModel.sorting === null ? 'none' : 'inline-block')"
                    (click)="swapSorting()"></i>
                </div>
              </div>
              <div class="element-group" *ngIf="(bite.type == classTypes.ComparisonChartBite)">
                <label >
                  Stack Chart
                </label>
                <div class="pull-right">
                  <div class="checkbox-slider pull-right">
                    <input [checked]="settingsModel.stackChart"
                           (change)="settingsModel.stackChart = $event.target.checked; renderContent()"
                           type="checkbox" name="checkbox-slider" class="checkbox-slider-checkbox" id="stack-chart-{{uuid}}">
                    <label class="checkbox-slider-label" for="stack-chart-{{uuid}}">
                      <span class="checkbox-slider-inner"></span>
                      <span class="checkbox-slider-switch"></span>
                    </label>
                  </div>
                </div>
              </div>
              <div class="element-group" *ngIf="showColorPatternChooser">
                <label >
                  Chart color
                </label>
                <div class="pull-right">
                  <ul class="color-picker">
                    <li *ngFor="let color of colorPattern" [ngStyle]="{'background-color': color}" class="color-item"
                        [ngClass]="{'color-item-selected': color === settingsModel.customColor}"
                        (click)="settingsModel.customColor = color; renderContent();">
                    </li>
                    <li class="color-item"
                      [ngStyle]="{'background-color': (colorPattern.indexOf(settingsModel.customColor) >= 0) ? '#ffffff' : settingsModel.customColor}"
                      [ngClass]="{'color-item-selected': (colorPattern.indexOf(settingsModel.customColor) == -1)}"
                      (click)="showCustomColorSection()">
                      <i class="glyphicon glyphicon-plus" style="display: table; font-size: 11px; margin-top: -1px; line-height: 1;"
                        [ngStyle]="{'color': (colorPattern.indexOf(settingsModel.customColor) >= 0) ? '#888' : '#fff'}"></i>
                    </li>
                  </ul>
                </div>
                <div class="element-group" [style.display]="displayCustomColor ? 'block' : 'none'">
                  <label for="custom-color-{{uuid}}">
                    Custom color (<small>css hex format only</small>)
                  </label>
                  <!--<input type="number" placeholder="Add custom value" [(ngModel)]="settingsModel.filterCustomValue" name="filterCustomValue">-->
                  <input #customColorInput id="custom-color-{{uuid}}" [(ngModel)]="this.temporaryCustomColor"
                         name="customColor" type="text"
                         (blur)="hideCustomColorSection()">
                </div>
              </div>
              <!-- TODO: not implemented yet -->
              <div class="element-group" *ngIf="false && bite.type == classTypes.ToplineBite">
                <label >
                  Exclude 0 values
                </label>
                <div class="checkbox-slider pull-right">
                  <input type="checkbox" name="checkbox-slider" class="checkbox-slider-checkbox" id="exclude-zero-{{uuid}}"
                         checked [(ngModel)]="settingsModel.filterZero" name="filterZero">
                  <label class="checkbox-slider-label" for="exclude-zero-{{uuid}}">
                    <span class="checkbox-slider-inner"></span>
                    <span class="checkbox-slider-switch"></span>
                  </label>
                </div>
              </div>
              <!-- TODO: not implemented yet -->
              <div class="element-group" *ngIf="false && bite.type == classTypes.ToplineBite">
                <label>
                  Exclude custom value
                </label>
                <input type="number" placeholder="Add custom value" [(ngModel)]="settingsModel.filterCustomValue" name="filterCustomValue">
              </div>
              <div class="element-group">
                <label>
                  Description
                </label>
                <textarea
                  [(ngModel)]="settingsModel.description"
                  name="description" class="count" rows="4"></textarea>
                <div class="count-container">{{settingsModel.descriptionRemaining}} chars left</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </form>
  </div>
</div>
